jQuery(document).ready(function($){!function(){function o(o,e,t){$.each(t.children(e),function(o,e){$(e).remove()});for(var a=1;a<=o;a++)$new_box=$(".prototype"+e).clone(!0),$new_box.removeClass("prototype"),$new_box.find(".input-group-addon").data("team",a).html(a),t.append($new_box)}var e=forms.total_team_count.find(".form-control");forms.total_team_count.ajaxForm({beforeSubmit:function(o,e,t){console.dir(o);var a=parseInt(o[0].value);return a<3?(alert("ERROR - 최소 3팀 이상이어야 합니다"),forms.total_team_count.clearForm(),!1):a>15?(alert("ERROR - 최대 15팀 까지만 허용됩니다"),forms.total_team_count.clearForm(),!1):void 0},success:function(o){var t=JSON.parse(o);if(console.dir(t),201==t.response_code){var a=parseInt(e.val());e.attr("placeholder",a).val(""),window.location.reload(),alert("성공! - 각 팀의 인원 * 비밀번호 설정해 주세요")}else alert("실패")},error:function(){alert("Error가 발생하였습니다.")}})}(),function(){$(".modal--team_settings .btn-success").click(function(o){var e={team_player_counts:new Array,team_passwords:new Array};e.total_team_count=forms.total_team_count.find(".form-control"),$.each(forms.team_player_counts.find(".form-control"),function(o,t){e.team_player_counts.push($(t))}),$.each(forms.team_passwords.find(".form-control"),function(o,t){e.team_passwords.push($(t))});var t={at_first:{team_player_counts:!1,team_passwords:!1},after_first:!1},a={result:!0,inputs:new Array},n={result:!1,inputs:new Array},s=e.team_player_counts.length+e.team_passwords.length,r=0;if($.each(e.team_player_counts,function(o,e){if(e.css("background-color","white"),e.val())e.val()<3&&(a.result=!1,a.inputs.push(e));else{if(0==e.attr("placeholder").length)return void(t.at_first.team_player_counts=!0);r++}}),$.each(e.team_passwords,function(o,a){if(a.css("background-color","white"),a.val())for(var l=o;l<e.team_passwords.length-1;l++)a.val()!=e.team_passwords[l+1].val()&&a.val()!=e.team_passwords[l+1].attr("placeholder")||(n.result=!0,n.inputs.push(a),n.inputs.push(e.team_passwords[l+1]));else{if(!a.attr("placeholder"))return void(t.at_first.team_passwords=!0);++r==s&&(t.after_first=!0)}}),t.at_first.team_player_counts)return alert("인원지정 입력란이 비어있습니다"),!1;if(!a.result)return alert("각 팀의 인원수는 최소 3명 이상이어야 합니다"),$.each(a.inputs,function(o,e){e.css("background-color","#FF8A80")}),!1;if(t.at_first.team_passwords)return alert("비밀번호 입력란이 비어있습니다"),!1;if(n.result)return $.each(n.inputs,function(o,e){e.css("background-color","yellow")}),alert("ERROR ! - 겹치는 비밀번호가 있습니다"),!1;if(t.after_first)return alert("입력된 값이 없습니다"),!1;var l={team_player_counts:{beforeSubmit:function(o,t,a){$.each(e.team_player_counts,function(e,t){!t.val()&&t.attr("placeholder")&&(o[e].value=t.attr("placeholder"))})},success:function(o){console.log(o),console.log("Success");var t=JSON.parse(o),a=!1;201==t.response_code&&($.each(e.team_player_counts,function(o,e){e.val()&&(e.attr("placeholder",e.val()),e.val(""),a=!0)}),a&&alert("인원 설정 완료!"))},error:function(){alert("Error가 발생하였습니다.")}},team_passwords:{beforeSubmit:function(o,t,a){$.each(e.team_passwords,function(e,t){!t.val()&&t.attr("placeholder")&&(o[e].value=t.attr("placeholder"))})},success:function(o){var t=JSON.parse(o),a=!1;201==t.response_code&&($.each(e.team_passwords,function(o,e){e.val()&&(e.attr("placeholder",e.val()),e.val(""),a=!0)}),a&&alert("비밀번호 설정 완료!"))},error:function(){alert("Error가 발생하였습니다.")}}};forms.team_player_counts.ajaxSubmit(l.team_player_counts),forms.team_passwords.ajaxSubmit(l.team_passwords)})}(),function(){var o=$(".modal--timer"),e=$("#form-timer_deadline"),t=e.find(".form-control"),a={beforeSubmit:function(o,e,a){var n=parseInt(o[0].value),s=parseInt(o[1].value),r=60*n+s;if(isNaN(r))return alert("시간을 입력해 주세요"),!1;t[0].placeholder=n,t[1].placeholder=s,t[0].value="",t[1].value="",o.pop(),o[0].name="timer_deadline",o[0].value=r},success:function(o){201==JSON.parse(o).response_code&&alert("완료")},error:function(){alert("Error가 발생하였습니다.")}};e.ajaxForm(a),$(".modal--timer .btn-all-start").click(function(o){$message_modal=$(".modal--check"),$message_modal.modal("show"),$(".modal--check__message").html(" 전체 타이머를 작동 시키시겠습니까? "),$(".modal--check .btn-yes").off("click"),$(".modal--check .btn-yes").click(function(o){return $message_modal.modal("hide"),$.post(CONTROLLER_URL,{timer_all_start:!0,total_team_count:total_team_count},function(o,e,t){console.dir(o);var a=JSON.parse(o);201==a.response_code?(alert("전체 팀의 타이머를 작동시켰습니다"),$(".modal--timer__each_team_control__clock").css("display","block"),$(".modal--timer__each_team_control__control").removeClass("btn-secondary").addClass("btn-danger").html("End")):alert(a.error_message)}),!1})}),$(".modal--timer .btn-all-end").click(function(o){$message_modal=$(".modal--check"),$message_modal.modal("show"),$(".modal--check__message").html(" 전체 타이머를 중지 시키시겠습니까? "),$(".modal--check .btn-yes").off("click"),$(".modal--check .btn-yes").click(function(o){return $message_modal.modal("hide"),$.post(CONTROLLER_URL,{timer_all_end:!0,total_team_count:total_team_count},function(o,e,t){var a=JSON.parse(o);201==a.response_code?(alert("전체 팀의 타이머를 중지시켰습니다"),$(".modal--timer__each_team_control__clock").css("display","none"),$(".modal--timer__each_team_control__control").removeClass("btn-danger").addClass("btn-secondary").html("Ready")):alert(a.error_message)}),!1})}),$(".modal--timer__each_team_control__control").click(function(o){var e=$(this),t=e.siblings(".input-group-addon").data("team");e.hasClass("btn-danger")&&$.post(CONTROLLER_URL,{timer_end:!0,team:t},function(o,a,n){var s=JSON.parse(o);201==s.response_code?(e.siblings(".modal--timer__each_team_control__clock").css("display","none"),e.removeClass("btn-danger").addClass("btn-secondary").html("Ready"),alert(t+"팀의 타이머 종료")):alert(s.error_message)})})}(),function(){var o={beacon:$("input[name=checkbox-beacon]").bootstrapSwitch(),player_list:$("input[name=checkbox-player_list]").bootstrapSwitch(),joker_info:$("input[name=checkbox-joker_info]").bootstrapSwitch()};o.beacon.on("switchChange.bootstrapSwitch",function(o,e){$.post(CONTROLLER_URL,{option_update:!0,beacon_state:e},function(o,t,a){201==JSON.parse(o).response_code&&($(".modal--options__beacon__body__beacon_list").slideToggle("slow"),e?alert("비콘을 사용합니다"):alert("비콘을 사용하지 않습니다"))})}),$(".modal--options__beacon__body__beacon_list__modifier").click(function(o){var e=$(this),t=e.data("post"),a=e.closest("td").siblings("td.modal--options__beacon__body__beacon_list__data"),n=a.children("span"),s=a.children("input");n.css("display","none"),s.css("display","block"),e.css("display","none"),e.siblings(".modal--options__beacon__body__beacon_list__update").css("display","block")}),$(".modal--options__beacon__body__beacon_list__update").click(function(o){var e=$(this),t=e.data("post"),a=e.closest("td").siblings("td.modal--options__beacon__body__beacon_list__data"),n=a.children("span"),s=a.children("input"),r=$(n[0]),l=$(n[1]),i=$(s[0]),c=$(s[1]),_={post:t,item:i.val(),url:c.val()};$.post(CONTROLLER_URL,{beacon_data:_},function(o,t,a){201==JSON.parse(o).response_code?(alert("수정 완료!"),r.html(_.item),l.html(_.url),n.css("display","block"),s.css("display","none"),e.css("display","none"),e.siblings(".modal--options__beacon__body__beacon_list__modifier").css("display","block")):alert("ERROR!")})}),o.player_list.on("switchChange.bootstrapSwitch",function(e,t){$.post(CONTROLLER_URL,{option_update:!0,player_list_state:t},function(e,a,n){201==JSON.parse(e).response_code&&(t?alert("교육생이 명단을 입력도록 설정합니다"):(o.joker_info.bootstrapSwitch("state")&&o.joker_info.bootstrapSwitch("toggleState"),alert("교육생이 명단을 입력하지 않아도 게임을 진행 할 수 있도록 설정합니다")),$(".modal--options__player_list__body").slideToggle("fast"))})}),o.joker_info.on("switchChange.bootstrapSwitch",function(o,e){$.post(CONTROLLER_URL,{option_update:!0,joker_info_state:e},function(o,t,a){201==JSON.parse(o).response_code&&(e?alert("조커 정보를 입력하도록 설정합니다"):alert("조커 정보 입력을 생략하도록 설정합니다"),$(".modal--options__joker_info__body").slideToggle("slow"))})}),$(".btn-set_joker_info_questions_count").click(function(o){var e=$(this);$(".modal--check").modal(),$(".btn-yes").off("click"),$(".modal--check__message").html("모든 질문이 초기화 됩니다"),$(".btn-yes").click(function(o){var t=e.siblings(".form-control"),a=t[0].valueAsNumber;if(a>6||a<1)return alert("ERROR - 질문의 개수는 1 ~ 6개 사이에서 결정해 주세요"),void $(".modal--check").modal("hide");$.post(CONTROLLER_URL,{reset_joker_info_questions:!0},function(o,e,n){if(201==JSON.parse(o).response_code){t.val(""),$(".modal--options__joker_info__body__questions__question:not(.prototype)").remove();for(var s=0;s<a;s++){var r=$(".prototype.modal--options__joker_info__body__questions__question_setting").clone();r.removeClass("prototype").children("input").attr("placeholder",s+1+"번째 질문"),forms.joker_info_questions.children(".inner").append(r)}$(".modal--options .complete-btn-container").css("display","block"),$(".modal--check").modal("hide")}})})}),forms.joker_info_questions.ajaxForm({beforeSubmit:function(o,e,t){$.each(o,function(o,e){if(e.value.length<1)return alert("모든 질문을 설정해 주세요"),!1})},success:function(o){201==JSON.parse(o).response_code?($.each($(".modal--options__joker_info__body__questions__question_setting:not(.prototype) > input"),function(o,e){$input=$(e);var t=$(".prototype.modal--options__joker_info__body__questions__question").clone();t.removeClass("prototype").find(".text-left").html(o+1+"번째 질문 : ").siblings(".text-center").html($input.val()),$input.closest(".modal--options__joker_info__body__questions__question_setting").remove(),forms.joker_info_questions.children(".inner").append(t)}),$(".modal--options .complete-btn-container").css("display","none"),alert("성공!")):alert("실패")},error:function(){alert("Error가 발생하였습니다.")}})}(),function(){function o(o){var e=/(\.|\/)(jpg|jpe?g|png)$/i;"post_maps"==o&&(e=/(\.|\/)(jpg)$/i),$("#fileupload--"+o).fileupload({url:"../Resources/Libraries/jQuery_File_Upload/server/php/index.php?the_dir="+o,acceptFileTypes:e,sequentialUploads:!1}).on("fileuploadprocessalways",function(e,t){if("post_maps"==o){var a=getOnlyFileName(t.files[0].name);(isNaN(parseInt(a))||(parseInt(a)+"").length!=a.length)&&(alert("포스트 지도 파일의 형식을 확인해주세요 ! ( 1.jpg, 2.jpg, 3.jpg, 4.jpg... )"),t.abort())}t.files.error&&currentFile.error&&console.log(currentFile.error)})}function e(o){$("#fileupload--"+o).addClass("fileupload-processing"),$.ajax({url:$("#fileupload--"+o).fileupload("option","url"),dataType:"json",context:$("#fileupload--"+o)[0]}).always(function(){$(this).removeClass("fileupload-processing")}).done(function(o){$(this).fileupload("option","done").call(this,$.Event("done"),{result:o})})}var t={whole_map:"whole_map",assistant_map:"assistant_map",post_maps:"post_maps"};$.each(t,function(t,a){o(a),e(a)})}(),function(){var o=$(".modal--points input[name='points[]']");$(".modal--points .btn-success").click(function(e){var t={beforeSubmit:function(o,e,t){},success:function(e){201==JSON.parse(e).response_code&&$.each(o,function(o,e){var t=$(e),a=t.val();a&&alert(o+1+"팀에 "+a+"점을 제공하였습니다")}),forms.points.clearForm(),$(".modal--points").modal("hide")},error:function(){alert("Error가 발생하였습니다.")}};forms.points.ajaxSubmit(t)})}(),function(){$(".modal--mapping_points__point_box__modification-btn").click(function(o){var e=$(this),t=e.closest(".modal--mapping_points__point_box"),a=e.siblings("span"),n=a.data("point_info"),s=$(".prototype.modal--mapping_points__point-editmode").clone();s.removeClass("prototype");var r=s.children(".modal--mapping_points__point-editmode__input-box"),l=s.children(".modal--mapping_points__point-editmode__cancle-btn"),i=s.children(".modal--mapping_points__point-editmode__complete-btn");r.attr("placeholder",n.point),t.append(s),a.css("display","none"),e.css("display","none"),s.css("display","inline-block"),cDir("point_info",n),l.click(function(o){s.remove(),a.css("display","inline-block"),e.css("display","inline-block")}),i.click(function(o){n.point=r.val(),$.post(CONTROLLER_URL,n,function(o){201==JSON.parse(o).response_code&&("time_minus"==n.mapping_target?a.text("(-)"+n.point):a.text(n.point),s.remove(),a.css("display","inline-block"),e.css("display","inline-block"))})})})}(),function(){var o={manager:forms.manager_password.find("input[name=password]"),assistant:forms.assistant_password.find("input[name=password]")},e={manager:{beforeSubmit:function(o,e,t){},success:function(e){201==JSON.parse(e).response_code&&(o.manager.attr("placeholder","현재: "+o.manager.val()).val(""),alert("성공!"))},error:function(o){alert(o)}},assistant:{beforeSubmit:function(o,e,t){},success:function(e){console.log(e),201==JSON.parse(e).response_code&&(o.assistant.attr("placeholder","현재: "+o.assistant.val()).val(""),alert("성공!"))},error:function(o){alert(o)}}};forms.manager_password.ajaxForm(e.manager),forms.assistant_password.ajaxForm(e.assistant)}(),function(){$(".menu__item--reset > button").click(function(o){$message_modal=$(".modal--check"),$message_modal.modal("show"),$(".modal--check__message").html(" 모든 세팅을 리셋하시겠습니까? <br> (단, 관리자 비밀번호, 점수배분표, 비콘 등등..은 기본값을 유지합니다. ) "),$(".modal--check .btn-yes").off("click"),$(".modal--check .btn-yes").click(function(o){$.post(CONTROLLER_URL,{reset:!0},function(o,e,t){201==parseInt(o)&&(alert("리셋 완료!"),window.location.reload())})})})}()});